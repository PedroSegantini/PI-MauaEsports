<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Painel do Administrador - Mauá Esports</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="styles.css" rel="stylesheet" />
</head>

<body class="admin-body" onload="loadContent()">
  <div class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h1 class="admin-title">Painel de Administração Mauá Esports</h1>
      <a href="index.html" class="btn btn-primary">
        <i class="bi bi-box-arrow-left"></i> Sair
      </a>
    </div>

    <!-- Painel de Alteração de Texto -->
    <div class="card admin-card mb-4">
      <div class="card-header admin-card-header">
        <h3 class="mb-0">
          <i class="bi bi-pencil-square panel-icon"></i>
          Alterar Textos do Site
        </h3>
      </div>
      <div class="card-body">
        <form id="text-form">
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="text-section" class="form-label">Seção do Texto:</label> <select id="text-section"
                class="form-select admin-form-control" required>
                <option value="">Selecione a seção</option>
                <optgroup label="Quem Somos">
                  <option value="hero.title">Título Principal</option>
                  <option value="hero.subtitle">Subtítulo</option>
                  <option value="hero.description">Descrição</option>
                </optgroup>
                <optgroup label="Times">
                  <option value="times.title">Título</option>
                  <option value="times.subtitle">Subtítulo</option>
                  <option value="times.description">Descrição</option>
                </optgroup>
                <optgroup label="Campeonatos">
                  <option value="campeonatos.title">Título</option>
                  <option value="campeonatos.subtitle">Subtítulo</option>
                  <option value="campeonatos.description">Descrição</option>
                </optgroup>
              </select>
            </div>
            <div class="col-md-6 mb-3">
              <label for="current-text" class="form-label">Texto Atual:</label>
              <input type="text" class="form-control admin-form-control" id="current-text" readonly>
            </div>
          </div>
          <div class="mb-3">
            <label for="new-text" class="form-label">Novo Texto:</label>
            <textarea class="form-control admin-form-control" id="new-text" rows="3"
              placeholder="Digite o novo texto aqui..." required></textarea>
          </div>
          <button type="submit" class="btn btn-primary">
            <i class="bi bi-check-circle"></i> Atualizar Texto
          </button>
        </form>
        <div id="text-status" class="status-display" style="display: none;">
          <div class="alert" id="text-alert"></div>
        </div>
      </div>
    </div>

    <!-- Painel de Atribuição de Cargos -->
    <div class="card admin-card mb-4">
      <div class="card-header admin-card-header">
        <h3 class="mb-0">
          <i class="bi bi-person-gear panel-icon"></i>
          Atribuição de Cargos
        </h3>
      </div>
      <div class="card-body">
        <form id="role-form">
          <div class="row">
            <div class="col-md-8 mb-3">
              <label for="user-email" class="form-label">Email do Usuário:</label>
              <input type="email" class="form-control admin-form-control" id="user-email" placeholder="usuario@maua.br"
                required>
              <div id="user-suggestions" class="mt-2"></div>
            </div>
            <div class="col-md-4 mb-3">
              <label for="user-role" class="form-label">Cargo:</label>
              <select id="user-role" class="form-select admin-form-control" required>
                <option value="">Selecione o cargo</option>
                <option value="admin">Administrador</option>
                <option value="captain">Capitão</option>
                <option value="player">Jogador</option>
              </select>
            </div>
          </div>
          <div class="mb-3">
            <button type="button" class="btn btn-info me-2" id="search-user">
              <i class="bi bi-search"></i> Buscar Usuário
            </button>
            <button type="submit" class="btn btn-success">
              <i class="bi bi-person-check"></i> Atribuir Cargo
            </button>
          </div>
        </form>
        <div id="selected-user" class="user-search-result" style="display: none;">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <strong id="selected-user-name"></strong>
              <br>
              <small class="text-muted" id="selected-user-email"></small>
            </div>
            <span class="role-badge" id="selected-user-role"></span>
          </div>
        </div>
        <div id="role-status" class="status-display" style="display: none;">
          <div class="alert" id="role-alert"></div>
        </div>
      </div>
    </div>

    <!-- Painel de Consulta de Horas PAE -->
    <div class="card admin-card mb-4">
      <div class="card-header admin-card-header">
        <h3 class="mb-0">
          <i class="bi bi-clock-history panel-icon"></i>
          Consulta de Horas PAE
        </h3>
      </div>
      <div class="card-body">
        <form id="pae-form">
          <div class="row">
            <div class="col-md-8 mb-3">
              <label for="pae-user-email" class="form-label">Email do Usuário:</label>
              <input type="email" class="form-control admin-form-control" id="pae-user-email"
                placeholder="usuario@maua.br" required>
            </div>
            <div class="col-md-4 mb-3 d-flex align-items-end">
              <button type="submit" class="btn btn-primary w-100">
                <i class="bi bi-search"></i> Consultar Horas
              </button>
            </div>
          </div>
        </form>
        <div id="pae-results" style="display: none;">
          <div class="status-display">
            <h5>Informações do Usuário</h5>
            <div class="row">
              <div class="col-md-6">
                <p><strong>Nome:</strong> <span id="pae-user-name"></span></p>
                <p><strong>Email:</strong> <span id="pae-user-email-display"></span></p>
                <p><strong>RA:</strong> <span id="pae-user-ra"></span></p>
              </div>
              <div class="col-md-6">
                <p><strong>Cargo:</strong> <span class="role-badge" id="pae-user-role"></span></p>
                <p><strong>Horas PAE Totais:</strong> <span id="pae-total-hours" class="text-info fw-bold"></span></p>
                <p><strong>Última Atualização:</strong> <span id="pae-last-update"></span></p>
              </div>
            </div>
            <div class="mt-3">
              <h6>Histórico de Atividades</h6>
              <div id="pae-activities" class="mt-2"></div>
            </div>
          </div>
        </div>
        <div id="pae-status" class="status-display" style="display: none;">
          <div class="alert" id="pae-alert"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" />
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>



  </script>
  <script>
    const api1 = axios.create({
      baseURL: "http://localhost:3001",
    });    // Objeto para armazenar os textos das seções
    let textSections = {
      'hero': {
        title: '',
        subtitle: '',
        description: ''
      },
      'times': {
        title: '',
        subtitle: '',
        description: ''
      },
      'campeonatos': {
        title: '',
        subtitle: '',
        description: ''
      }
    };

    // Função para carregar o conteúdo dinâmico
    async function loadContent() {
      try {
        const response = await api1.get("/content");
        const contents = response.data;

        // Atualiza o textSections com os dados do banco
        contents.forEach(content => {
          if (textSections[content.containerId]) {
            textSections[content.containerId] = {
              title: content.titulo,
              subtitle: content.subtitulo,
              description: content.paragrafo
            };
          }
        });

        // Atualiza o campo de texto atual se houver uma seção selecionada
        const selectedSection = document.getElementById('text-section').value;
        if (selectedSection) {
          updateCurrentText(selectedSection);
        }

        console.log("Conteúdo carregado:", textSections);
      } catch (error) {
        console.error("Erro ao carregar conteúdo:", error);
        showAlert('text-alert', 'text-status', 'Erro ao carregar conteúdo do banco de dados.', 'danger');
      }
    }

    const mockUsers = [
      { name: 'João Silva', email: 'joao.silva@maua.br', ra: '22.01234-5', role: 'admin', paeHours: 120 },
      { name: 'Maria Santos', email: 'maria.santos@maua.br', ra: '22.05678-9', role: 'captain', paeHours: 85 },
      { name: 'Pedro Costa', email: 'pedro.costa@maua.br', ra: '22.09876-3', role: 'player', paeHours: 45 }
    ]; function updateCurrentText(sectionPath) {
      const currentTextInput = document.getElementById('current-text');
      const [section, field] = sectionPath.split('.');
      currentTextInput.value = textSections[section][field] || '';
    }

    // Atualizar texto atual quando seção é selecionada
    document.getElementById('text-section').addEventListener('change', function () {
      updateCurrentText(this.value);
    });    // Form de alteração de texto
    document.getElementById('text-form').addEventListener('submit', async function (e) {
      e.preventDefault();
      const [section, field] = document.getElementById('text-section').value.split('.');
      const newText = document.getElementById('new-text').value;

      try {
        // Preparar os dados de atualização
        const updateData = {};

        // Mapear os campos do formulário para os campos do banco
        if (field === 'title') updateData.titulo = newText;
        if (field === 'subtitle') updateData.subtitulo = newText;
        if (field === 'description') updateData.paragrafo = newText;

        // Fazer a requisição PATCH para a API
        const response = await api1.patch(`/content/${section}`, updateData);

        if (response.data) {
          // Atualizar o objeto local com os dados retornados do servidor
          textSections[section] = {
            title: response.data.titulo,
            subtitle: response.data.subtitulo,
            description: response.data.paragrafo
          };

          // Atualizar a interface
          document.getElementById('current-text').value = newText;
          showAlert('text-alert', 'text-status', 'Texto atualizado com sucesso!', 'success');
          document.getElementById('new-text').value = '';

          // Recarregar todo o conteúdo para garantir sincronização
          await loadContent();
        }
      } catch (error) {
        console.error('Erro ao atualizar texto:', error);
        const errorMessage = error.response?.data?.message || 'Erro ao atualizar o texto no banco de dados.';
        showAlert('text-alert', 'text-status', errorMessage, 'danger');
      }
    });

    // Buscar usuário
    document.getElementById('search-user').addEventListener('click', function () {
      const email = document.getElementById('user-email').value;
      const user = mockUsers.find(u => u.email === email);

      if (user) {
        showUserInfo(user);
      } else {
        showAlert('role-alert', 'role-status', 'Usuário não encontrado.', 'danger');
      }
    });

    // Form de atribuição de cargo
    document.getElementById('role-form').addEventListener('submit', function (e) {
      e.preventDefault();
      const email = document.getElementById('user-email').value;
      const role = document.getElementById('user-role').value;

      const user = mockUsers.find(u => u.email === email);
      if (user) {
        user.role = role;
        showAlert('role-alert', 'role-status', `Cargo "${getRoleName(role)}" atribuído com sucesso!`, 'success');
        showUserInfo(user);
      } else {
        showAlert('role-alert', 'role-status', 'Usuário não encontrado.', 'danger');
      }
    });

    // Form de consulta PAE
    document.getElementById('pae-form').addEventListener('submit', function (e) {
      e.preventDefault();
      const email = document.getElementById('pae-user-email').value;
      const user = mockUsers.find(u => u.email === email);

      if (user) {
        showPAEInfo(user);
      } else {
        showAlert('pae-alert', 'pae-status', 'Usuário não encontrado.', 'danger');
        document.getElementById('pae-results').style.display = 'none';
      }
    });

    function showUserInfo(user) {
      document.getElementById('selected-user-name').textContent = user.name;
      document.getElementById('selected-user-email').textContent = user.email;
      const roleSpan = document.getElementById('selected-user-role');
      roleSpan.textContent = getRoleName(user.role);
      roleSpan.className = `role-badge role-${user.role}`;
      document.getElementById('selected-user').style.display = 'block';
    }

    function showPAEInfo(user) {
      document.getElementById('pae-user-name').textContent = user.name;
      document.getElementById('pae-user-email-display').textContent = user.email;
      document.getElementById('pae-user-ra').textContent = user.ra;

      const roleSpan = document.getElementById('pae-user-role');
      roleSpan.textContent = getRoleName(user.role);
      roleSpan.className = `role-badge role-${user.role}`;

      document.getElementById('pae-total-hours').textContent = `${user.paeHours}h`;
      document.getElementById('pae-last-update').textContent = new Date().toLocaleDateString('pt-BR');

      // Simular atividades
      const activities = [
        'Participação em campeonato - 20h',
        'Treinamento de equipe - 15h',
        'Organização de evento - 10h'
      ];

      const activitiesDiv = document.getElementById('pae-activities');
      activitiesDiv.innerHTML = activities.map(activity =>
        `<div class="user-search-result">${activity}</div>`
      ).join('');

      document.getElementById('pae-results').style.display = 'block';
      document.getElementById('pae-status').style.display = 'none';
    }

    function getRoleName(role) {
      const roles = {
        'admin': 'Administrador',
        'captain': 'Capitão',
        'player': 'Jogador'
      };
      return roles[role] || role;
    }

    function showAlert(alertId, statusId, message, type) {
      const alert = document.getElementById(alertId);
      const status = document.getElementById(statusId);

      alert.className = `alert alert-${type}`;
      alert.textContent = message;
      status.style.display = 'block';

      setTimeout(() => {
        status.style.display = 'none';
      }, 5000);
    }

    // Verificar autenticação
    window.addEventListener("DOMContentLoaded", async () => {
      try {
        const response = await fetch("/api/data");
        if (response.status === 401) {
          window.location.href = "/";
        }
      } catch (error) {
        console.log('Modo de demonstração ativo');
      }
    });
  </script>

</body>

</html>